name: Deploy to Hostinger
on:
  push:
    branches: [main]
    paths:
      - '**.html'
      - '**.css'
      - '**.js'
      - '**.json'
      - '**.xml'
      - '**.txt'
      - '**.php'
      - '.htaccess'
      - 'IMG/**'
      - 'icons/**'
      - 'api/**'
      - '.github/workflows/hostinger-deploy.yml'
  workflow_dispatch:

jobs:
  deploy:
    name: Deploy via SFTP
    runs-on: ubuntu-latest
    timeout-minutes: 15
    concurrency:
      group: hostinger-deploy-${{ github.ref }}
      cancel-in-progress: true

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Install lftp
        run: sudo apt-get update && sudo apt-get install -y lftp

      - name: Deploy to Hostinger
        env:
          HOST: ${{ secrets.HOSTINGER_FTP_SERVER }}
          USER: ${{ secrets.HOSTINGER_FTP_USERNAME }}
          PASS: ${{ secrets.HOSTINGER_FTP_PASSWORD }}
        run: |
          echo "ðŸš€ Starting deployment..."

          lftp -u "$USER","$PASS" -p 65002 sftp://$HOST <<'EOF'
            set sftp:auto-confirm yes
            set xfer:clobber on

            cd /home/u476428393/public_html/

            mirror -Rnev --delete --no-empty-dirs --parallel=4 \
              --exclude-glob .git \
              --exclude-glob .github \
              --exclude-glob .gitignore \
              --exclude-glob .DS_Store \
              --exclude-glob '*.md' \
              --exclude-glob deploy.sh \
              --exclude-glob .claude \
              --exclude-glob docs \
              --exclude-glob .deploy-trigger \
              . .

            bye
          EOF

          echo "âœ… Deployment complete"
